<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.0.1, furo 2022.09.29"/>
        <title>UltraMotionCapture.kps - Ultra Motion Capture v0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Ultra Motion Capture v0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo_polyu.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Ultra Motion Capture v0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev%20notes.html">Development Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design%20principles.html">Design Principles</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api.html">API References</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.html">UltraMotionCapture</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.html">UltraMotionCapture.analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.config.html">UltraMotionCapture.config</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.html">UltraMotionCapture.field</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans.html">UltraMotionCapture.field.Trans</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans_Nonrigid.html">UltraMotionCapture.field.Trans_Nonrigid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans_Rigid.html">UltraMotionCapture.field.Trans_Rigid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.transform_rst2sm.html">UltraMotionCapture.field.transform_rst2sm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.transform_sm2rst.html">UltraMotionCapture.field.transform_sm2rst</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.html">UltraMotionCapture.kps</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.Kps.html">UltraMotionCapture.kps.Kps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.Kps_Deform.html">UltraMotionCapture.kps.Kps_Deform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.Marker.html">UltraMotionCapture.kps.Marker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html">UltraMotionCapture.kps.MarkerSet</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.html">UltraMotionCapture.obj3d</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d.html">UltraMotionCapture.obj3d.Obj3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d_Deform.html">UltraMotionCapture.obj3d.Obj3d_Deform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d_Kps.html">UltraMotionCapture.obj3d.Obj3d_Kps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.load_obj_series.html">UltraMotionCapture.obj3d.load_obj_series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.mesh2pcd.html">UltraMotionCapture.obj3d.mesh2pcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.mesh_crop.html">UltraMotionCapture.obj3d.mesh_crop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.np2pcd.html">UltraMotionCapture.obj3d.np2pcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.np2pvpcd.html">UltraMotionCapture.obj3d.np2pvpcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd2np.html">UltraMotionCapture.obj3d.pcd2np</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_crop.html">UltraMotionCapture.obj3d.pcd_crop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_crop_front.html">UltraMotionCapture.obj3d.pcd_crop_front</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_center.html">UltraMotionCapture.obj3d.pcd_get_center</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_max_bound.html">UltraMotionCapture.obj3d.pcd_get_max_bound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_min_bound.html">UltraMotionCapture.obj3d.pcd_get_min_bound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.search_nearest_point.html">UltraMotionCapture.obj3d.search_nearest_point</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.search_nearest_point_idx.html">UltraMotionCapture.obj3d.search_nearest_point_idx</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.html">UltraMotionCapture.obj4d</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d.html">UltraMotionCapture.obj4d.Obj4d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d_Deform.html">UltraMotionCapture.obj4d.Obj4d_Deform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d_Kps.html">UltraMotionCapture.obj4d.Obj4d_Kps</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.html">UltraMotionCapture.utils</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.images_to_gif.html">UltraMotionCapture.utils.images_to_gif</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.obj_pick_points.html">UltraMotionCapture.utils.obj_pick_points</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for UltraMotionCapture.kps</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The :mod:`UltraMotionCapture.kps` module stands for *key points*. In :mod:`UltraMotionCapture` package, key points are essential elements to facilitate the processing of 4D images.</span>

<span class="sd">There are two different perspectives to arrange key points data: *time-wise* and *point-wise*. Reflecting these two ways of arrangement:</span>

<span class="sd">- The :class:`Kps` and `Kps_Deform` contain all key points&#39; data at a specific moment;</span>
<span class="sd">- While the :class:`Marker` contains a specific key point&#39;s data within a time period. To aggregate all key points&#39; data, :class:`MarkerSet` is provided.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">open3d</span> <span class="k">as</span> <span class="nn">o3d</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="kn">from</span> <span class="nn">UltraMotionCapture</span> <span class="kn">import</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">UltraMotionCapture</span> <span class="kn">import</span> <span class="n">obj3d</span>
<span class="kn">from</span> <span class="nn">UltraMotionCapture</span> <span class="kn">import</span> <span class="n">utils</span>

<div class="viewcode-block" id="Kps"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps">[docs]</a><span class="k">class</span> <span class="nc">Kps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of the key points that can be attached to a 3D object, i.e. a frame of the 4D object.</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.kps_source_points</span>
<span class="sd">        :math:`N` key points in 3D space stored in a (N, 3) :class:`numpy.array`.</span>

<span class="sd">    Example</span>
<span class="sd">    ---</span>
<span class="sd">    After initialisation, the :class:`Kps` object is empty. There are two ways to load key points into it:</span>

<span class="sd">    Manually selecting key points with :meth:`select_kps_points`. ::</span>

<span class="sd">        from UltraMotionCapture import kps</span>

<span class="sd">        points = kps.Kps()</span>
<span class="sd">        points.select_kps_points()  # this will trigger a point selection window</span>

<span class="sd">    Load key points from Vicon motion capture data stored in a :class:`MarkerSet` object with :meth:`load_from_markerset_frame` or :meth:`load_from_markerset_time`. ::</span>

<span class="sd">        from UltraMotionCapture import kps</span>
<span class="sd">        </span>
<span class="sd">        vicon = kps.MarkerSet()</span>
<span class="sd">        vicon.load_from_vicon(&#39;data/6kmh_softbra_8markers_1.csv&#39;)</span>
<span class="sd">        vicon.interp_field()</span>

<span class="sd">        points = kps.Kps()</span>
<span class="sd">        points.load_from_markerset_frame(vicon)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Kps.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># key points are stored in Nx3 numpy array</span></div>

<div class="viewcode-block" id="Kps.select_kps_points"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.select_kps_points">[docs]</a>    <span class="k">def</span> <span class="nf">select_kps_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Interactive manual points selection.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        source</span>
<span class="sd">            an :class:`open3d.geometry.PointCloud` object for points selection.</span>

<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        At current stage, the interactive manual points selection is realised with :mod:`open3d` package. It will be transferred to :mod:`pyvista` package in future development.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;please select key points&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">pick_points</span><span class="p">(</span><span class="n">pcd</span><span class="p">):</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizerWithEditing</span><span class="p">()</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">create_window</span><span class="p">()</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="n">pcd</span><span class="p">)</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">destroy_window</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">vis</span><span class="o">.</span><span class="n">get_picked_points</span><span class="p">()</span>

        <span class="n">pick</span> <span class="o">=</span> <span class="n">pick_points</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">obj3d</span><span class="o">.</span><span class="n">pcd2np</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_kps_source_points</span><span class="p">(</span>
            <span class="n">points</span><span class="p">[</span><span class="n">pick</span><span class="p">,</span> <span class="p">:]</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;selected key points:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span><span class="p">))</span></div>

<div class="viewcode-block" id="Kps.load_from_markerset_frame"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.load_from_markerset_frame">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_markerset_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markerset</span><span class="p">:</span> <span class="n">MarkerSet</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load key points to the :class:`Kps` object providing the :class:`MarkerSet` and frame index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        markerset</span>
<span class="sd">            a :class:`MarkerSet` object carrying Vicon motion capture data, which contains various frames.</span>
<span class="sd">        frame_id</span>
<span class="sd">            the frame index of the Vicon motion capture data to be loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">markerset</span><span class="o">.</span><span class="n">get_frame_coord</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
        <span class="n">points_cal</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_kps_source_points</span><span class="p">(</span><span class="n">points_cal</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kps.load_from_markerset_time"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.load_from_markerset_time">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_markerset_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markerset</span><span class="p">:</span> <span class="n">MarkerSet</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load key points to the :class:`Kps` object providing the :class:`MarkerSet` and time stamp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        markerset</span>
<span class="sd">            a :class:`MarkerSet` object carrying Vicon motion capture data, which contains various frames.</span>

<span class="sd">            Warnings</span>
<span class="sd">            ---</span>
<span class="sd">            Before passing into :meth:`load_from_markerset_time`, call :meth:`MarkerSet.interp_field` first so that coordinates data at any specific time is accessible.</span>
<span class="sd">        time</span>
<span class="sd">            the time stamp of Vicon motion data to be loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">markerset</span><span class="o">.</span><span class="n">get_time_coord</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">points_cal</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_kps_source_points</span><span class="p">(</span><span class="n">points_cal</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kps.set_kps_source_points"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.set_kps_source_points">[docs]</a>    <span class="k">def</span> <span class="nf">set_kps_source_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Other than manually selecting points or loading points from Vicon motion capture data, the :attr:`kps_source_points` can also be directly overridden with a (N, 3) :class:`numpy.array`, representing :math:`N` key points in 3D space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        points</span>
<span class="sd">            (N, 3) :class:`numpy.array`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span> <span class="o">=</span> <span class="n">points</span></div>

<div class="viewcode-block" id="Kps.get_kps_source_points"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.get_kps_source_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_kps_source_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Get the key points coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;source key points haven&#39;t been set&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span></div></div>


<div class="viewcode-block" id="Kps_Deform"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps_Deform.html#UltraMotionCapture.kps.Kps_Deform">[docs]</a><span class="k">class</span> <span class="nc">Kps_Deform</span><span class="p">(</span><span class="n">Kps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adding deformation feature to the :class:`Kps` class.</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.trans</span>
<span class="sd">        An :class:`UltraMotionCapture.field.Trans_Nonrigid` object that stores the deformation information.</span>
<span class="sd">    self.kps_deform_points</span>
<span class="sd">        (N, 3) :class:`numpy.array`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Kps_Deform.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps_Deform.html#UltraMotionCapture.kps.Kps_Deform.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Kps</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kps_deform_points</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Kps_Deform.set_trans"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps_Deform.html#UltraMotionCapture.kps.Kps_Deform.set_trans">[docs]</a>    <span class="k">def</span> <span class="nf">set_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">:</span> <span class="n">field</span><span class="o">.</span><span class="n">Trans_Nonrigid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Setting the transformation of the deformable key points object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        trans</span>
<span class="sd">            an :meth:`UltraMotionCapture.field.Trans_Nonrigid` object that represents the transformation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="n">trans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kps_deform_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">shift_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kps_source_points</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kps_Deform.get_kps_deform_points"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps_Deform.html#UltraMotionCapture.kps.Kps_Deform.get_kps_deform_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_kps_deform_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Get the key points coordinates after transformation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kps_deform_points</span></div></div>


<div class="viewcode-block" id="Marker"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker">[docs]</a><span class="k">class</span> <span class="nc">Marker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Storing single key point&#39;s coordinates data within a time period. Usually loaded from the Vicon motion capture data. In this case, a key point is also referred as a marker.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---</span>
<span class="sd">    name</span>
<span class="sd">        the name of the marker.</span>
<span class="sd">    start_time</span>
<span class="sd">        the start time of the coordinates data.</span>
<span class="sd">    fps</span>
<span class="sd">        the number of frames per second (fps).</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.name</span>
<span class="sd">        The name of the marker.</span>
<span class="sd">    self.start_time</span>
<span class="sd">        The start time of the coordinates data.</span>
<span class="sd">    self.fps</span>
<span class="sd">        The number of frames per second (fps).</span>
<span class="sd">    self.coord</span>
<span class="sd">        :math:`3 \\times N` :class:`numpy.array` storing the coordinates data, with :math:`x, y, z` as rows and frame ids as the columns.</span>
<span class="sd">    self.speed</span>
<span class="sd">        :math:`3 \\times N` :class:`numpy.array` storing the speed data, with :math:`x, y, z` as rows and frame ids as the columns.</span>
<span class="sd">    self.accel</span>
<span class="sd">        :math:`3 \\times N` :class:`numpy.array` storing the acceleration data, with :math:`x, y, z` as rows and frame ids as the columns.</span>
<span class="sd">    self.frame_num</span>
<span class="sd">        The number of total frames.</span>
<span class="sd">    self.x_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`x` coordinates of all frames. Used for estimated the :math:`x` coordinate of any intermediate time between frames.</span>
<span class="sd">    self.y_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`y` coordinates of all frames. Used for estimated the :math:`y` coordinate of any intermediate time between frames.</span>
<span class="sd">    self.z_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`z` coordinates of all frames. Used for estimated the :math:`z` coordinate of any intermediate time between frames.</span>

<span class="sd">    Tip</span>
<span class="sd">    ---</span>
<span class="sd">    When loading Vicon motion capture data, the whole process is arranged by a :class:`MakerSet` object, which creates :class:`Marker` objects for each key point and loads data into it accordingly. Therefore, usually the end user doesn&#39;t need to touch the :class:`Marker` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Marker.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>

        <span class="c1"># x, y,z data are stored in 3xN numpy array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># acceleration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_num</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Marker.fill_data"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.fill_data">[docs]</a>    <span class="k">def</span> <span class="nf">fill_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filling coordinates, speed, and acceleration data, one by one, into the :class:`Marker` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        data_input</span>
<span class="sd">            :math:`3 \\times N` :class:`numpy.array`.</span>

<span class="sd">        Attention</span>
<span class="sd">        ---</span>
<span class="sd">        Called by the :class:`MarkerSet` object when parsing the Vicon motion capture data (:meth:`MarkerSet.load_from_vicon`). Usually the end user don&#39;t need to call this method manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">data_input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_num</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">data_input</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="n">data_input</span></div>

<div class="viewcode-block" id="Marker.interp_field"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.interp_field">[docs]</a>    <span class="k">def</span> <span class="nf">interp_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolating the :math:`x, y, z` coordinates data to estimate its continues change. After that, the coordinates at the intermediate time between frames is accessible.</span>

<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        Before interpolation, the coordinates data, i.e. :attr:`self.coord`, must be properly loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coordinates information not found&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">frame_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Marker.get_frame_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.get_frame_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_frame_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to frame id.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to get coordinates data.</span>
<span class="sd">        </span>
<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[0-2 as x-z][frame_id]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[:,</span> <span class="n">frame_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="Marker.get_time_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.get_time_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to time stamp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        time</span>
<span class="sd">            time stamp to get coordinates data.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[0-2 as x-z][time]`</span>
<span class="sd">        </span>
<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        The interpolation must be properly done before accessing coordinates data according to time stamp, which means the :meth:`interp_field` must be called first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coordinates field need to be interped first&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">frame_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
        <span class="n">coord_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">coord_interp</span></div>

<div class="viewcode-block" id="Marker.plot_track"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_track">[docs]</a>    <span class="k">def</span> <span class="nf">plot_track</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">line_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">line_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dot_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">dot_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">line_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">dot_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">dot_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
            <span class="n">is_show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plotting the marker motion track.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        line_start_frame</span>
<span class="sd">            start frame of line plotting.</span>
<span class="sd">        line_end_frame</span>
<span class="sd">            end frame of line plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        dot_start_frame</span>
<span class="sd">            start frame of dot plotting.</span>
<span class="sd">        dot_end_frame</span>
<span class="sd">            end frame of dot plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        is_show</span>
<span class="sd">            weather show the generated graph or not.</span>
<span class="sd">        is_save</span>
<span class="sd">            weather save the generated graph or not.</span>
<span class="sd">        Others</span>
<span class="sd">            parameters passed to :meth:`plot_add_line` and :meth:`plot_add_dot` to controlling the appearance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_add_line</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">line_start_frame</span><span class="p">,</span>
            <span class="n">line_end_frame</span><span class="p">,</span>
            <span class="n">line_alpha</span><span class="p">,</span>
            <span class="n">line_width</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_add_dot</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">dot_start_frame</span><span class="p">,</span>
            <span class="n">dot_end_frame</span><span class="p">,</span>
            <span class="n">dot_s</span><span class="p">,</span>
            <span class="n">dot_alpha</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marker Point Trajectory</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;output/save-line&#39;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_start_frame</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_end_frame</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;-dot&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dot_start_frame</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dot_end_frame</span><span class="p">))</span></div>

<div class="viewcode-block" id="Marker.plot_add_line"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_add_line">[docs]</a>    <span class="k">def</span> <span class="nf">plot_add_line</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">,</span>
            <span class="n">line_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">line_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">line_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adding motion track lines to the :class:`matplotlib.pyplot.subplot` object created in :meth:`plot_track`.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        About the appearance controlling parameters, please refer to `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_.</span>

<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">line_alpha</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Marker.plot_add_dot"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_add_dot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_add_dot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">,</span>
            <span class="n">dot_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">dot_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dot_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">dot_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adding motion dots in different frames to the :class:`matplotlib.pyplot.subplot` object created in :meth:`plot_track`.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        About the appearance controlling parameters, please refer to `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_.</span>

<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">dot_s</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">dot_alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="MarkerSet"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet">[docs]</a><span class="k">class</span> <span class="nc">MarkerSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of :class:`Marker` s. At current stage, it&#39;s usually loaded from the Vicon motion capture data.</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.fps</span>
<span class="sd">        The number of frames per second (fps).</span>
<span class="sd">    self.points</span>
<span class="sd">        A :class:`Dictonary` of :class:`Marker` s, with the corresponding marker names as their keywords.</span>

<span class="sd">    Example</span>
<span class="sd">    ---</span>
<span class="sd">    The Vicon motion capture data shall be exported as a :code:`.csv` file. After initialising the :class:`MarkerSet` data, we can load it providing the :code:`.csv` file&#39;s directory: ::</span>

<span class="sd">        from UltraMotionCapture import kps</span>

<span class="sd">        vicon = kps.MarkerSet()</span>
<span class="sd">        vicon.load_from_vicon(&#39;data/6kmh_softbra_8markers_1.csv&#39;)</span>
<span class="sd">        vicon.interp_field()</span>

<span class="sd">    Usually we implement the interpolation after loading the data, as shown in the last line of code. Then we can access the coordinates, speed, and acceleration data of any marker at any specific time: ::</span>

<span class="sd">        print(vicon.get_frame_coord(10))</span>
<span class="sd">        print(vicon.get_time_coord(1.0012)</span>

<span class="sd">    We can also access the specific marker with the marker name: ::</span>

<span class="sd">        print(vicon.points.keys())</span>
<span class="sd">        print(vicon.points[&#39;Bra_Miss Sun:CLAV&#39;].get_frame_coord(10))</span>
<span class="sd">        print(vicon.points[&#39;Bra_Miss Sun:CLAV&#39;].get_time_coord(1.0012))</span>

<span class="sd">    We can also plot and save the motion track as a :code:`.gif` file for illustration: ::</span>

<span class="sd">        vicon.plot_track(step=3, end_frame=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MarkerSet.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MarkerSet.load_from_vicon"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.load_from_vicon">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_vicon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filedir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load and parse data from :code:`.csv` file exported from the Vicon motion capture system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        filedir</span>
<span class="sd">            the directory of the :code:`.csv` file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_head</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">df_head</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># parse the fps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">col_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">col_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)):</span>
                <span class="n">col_name</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">[</span><span class="n">col_id</span><span class="p">]</span>
                <span class="n">point_name</span> <span class="o">=</span> <span class="n">col_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># skip columns that contain NaN</span>
                <span class="c1"># (checking start from row 4, because for speed and acceleration the first few rows are empty)</span>
                <span class="c1"># or that follows the &#39;X&#39; columns</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span> <span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="s1">&#39;Unnamed&#39;</span> <span class="ow">in</span> <span class="n">col_name</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># the first occurrence of a point</span>
                <span class="k">if</span> <span class="n">point_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">point_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Marker</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

                <span class="c1"># fill the following 3 columns&#39; X, Y, Z values into the point&#39;s object</span>
                <span class="n">data_input</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="n">col_name</span><span class="p">:</span><span class="n">col_names</span><span class="p">[</span><span class="n">col_id</span><span class="o">+</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">point_name</span><span class="p">]</span><span class="o">.</span><span class="n">fill_data</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># skip the first two rows</span>
        <span class="n">df_head</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># only read the first two rows</span>
        <span class="n">parse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_head</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loaded 1 vicon file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filedir</span><span class="p">))</span></div>

<div class="viewcode-block" id="MarkerSet.interp_field"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.interp_field">[docs]</a>    <span class="k">def</span> <span class="nf">interp_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After loading Vicon motion capture data, the :class:`MarkerSet` object only carries the key points&#39; coordinates in discrete frames. To access the coordinates at any specific time, it&#39;s necessary to call :meth:`interp_field`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">point</span><span class="o">.</span><span class="n">interp_field</span><span class="p">()</span></div>

<div class="viewcode-block" id="MarkerSet.get_frame_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.get_frame_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_frame_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to frame id.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to get coordinates data.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[marker_id][0-2 as x-z][frame_id]`</span>

<span class="sd">        WARNING</span>
<span class="sd">        ---</span>
<span class="sd">        The returned value will be transferred to :class:`Kps` in future development.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">point</span><span class="o">.</span><span class="n">get_frame_coord</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkerSet.get_time_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.get_time_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to time stamp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        time</span>
<span class="sd">            time stamp to get coordinates data.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[marker_id][0-2 as x-z][time]`</span>
<span class="sd">        </span>
<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        The interpolation must be properly done before accessing coordinates data according to time stamp, which means the :meth:`interp_field` must be called first.</span>

<span class="sd">        WARNING</span>
<span class="sd">        ---</span>
<span class="sd">        The returned value will be transferred to :class:`Kps` in future development.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">point</span><span class="o">.</span><span class="n">get_time_coord</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkerSet.plot_track"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.plot_track">[docs]</a>    <span class="k">def</span> <span class="nf">plot_track</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">remove</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plotting the marker motion track.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        start_frame</span>
<span class="sd">            start frame of plotting.</span>
<span class="sd">        end_frame</span>
<span class="sd">            end frame of plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        step</span>
<span class="sd">            Plot 1 frame for every :code:`step` frame. The purpose is reducing graph generating time.</span>
<span class="sd">        remove</span>
<span class="sd">            after generating the :code:`.gif` file, remove the frames&#39; images or not.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_ and `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">end_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">first_point</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">end_frame</span> <span class="o">=</span> <span class="n">first_point</span><span class="o">.</span><span class="n">frame_num</span>

        <span class="k">for</span> <span class="n">frame_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_frame</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_frame</span><span class="p">(</span><span class="n">frame_id</span><span class="p">,</span> <span class="n">is_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">images_to_gif</span><span class="p">(</span><span class="s1">&#39;output/&#39;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="n">remove</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkerSet.plot_frame"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.plot_frame">[docs]</a>    <span class="k">def</span> <span class="nf">plot_frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
            <span class="n">is_add_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a specific frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to be plotted.</span>
<span class="sd">        dpi</span>
<span class="sd">            the dots per inch (dpi) of the generated graph, controlling the graph quality.</span>
<span class="sd">        is_add_line</span>
<span class="sd">            weather add track links or not</span>
<span class="sd">        is_show</span>
<span class="sd">            weather show the generated graph or not.</span>
<span class="sd">        is_save</span>
<span class="sd">            weather save the generated graph or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">point</span><span class="o">.</span><span class="n">plot_add_dot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">frame_id</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_add_line</span><span class="p">:</span>
                <span class="n">point</span><span class="o">.</span><span class="n">plot_add_line</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marker Point Trajectory&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;output/gif-</span><span class="si">{:0&gt;4d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">is_show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
            <span class="n">filedir</span> <span class="o">=</span> <span class="s1">&#39;output/gif-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filedir</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved &#39;</span> <span class="o">+</span> <span class="n">filedir</span><span class="p">)</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Dr. Kit-lun Yick&#39;s Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>