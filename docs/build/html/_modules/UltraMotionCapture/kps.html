<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.0.1, furo 2022.09.29"/>
        <title>UltraMotionCapture.kps - Ultra Motion Capture v0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Ultra Motion Capture v0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo_polyu.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Ultra Motion Capture v0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev%20notes.html">Development Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design%20principles.html">Design Principles</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api.html">API References</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.html">UltraMotionCapture</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.html">UltraMotionCapture.analysis</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.reg_cpd.html">UltraMotionCapture.analysis.reg_cpd</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.reg_cpd.Obj3d_CPD.html">UltraMotionCapture.analysis.reg_cpd.Obj3d_CPD</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.reg_cpd.Obj4d_CPD.html">UltraMotionCapture.analysis.reg_cpd.Obj4d_CPD</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.analysis.reg_cpd.Trans_Nonrigid_CPD.html">UltraMotionCapture.analysis.reg_cpd.Trans_Nonrigid_CPD</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.config.html">UltraMotionCapture.config</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.config.param.html">UltraMotionCapture.config.param</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.html">UltraMotionCapture.field</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans.html">UltraMotionCapture.field.Trans</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans_Nonrigid.html">UltraMotionCapture.field.Trans_Nonrigid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.Trans_Rigid.html">UltraMotionCapture.field.Trans_Rigid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.transform_rst2sm.html">UltraMotionCapture.field.transform_rst2sm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.field.transform_sm2rst.html">UltraMotionCapture.field.transform_sm2rst</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.html">UltraMotionCapture.kps</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.Kps.html">UltraMotionCapture.kps.Kps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.Marker.html">UltraMotionCapture.kps.Marker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html">UltraMotionCapture.kps.MarkerSet</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.html">UltraMotionCapture.obj3d</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d.html">UltraMotionCapture.obj3d.Obj3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d_Deform.html">UltraMotionCapture.obj3d.Obj3d_Deform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.Obj3d_Kps.html">UltraMotionCapture.obj3d.Obj3d_Kps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.load_obj_series.html">UltraMotionCapture.obj3d.load_obj_series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.mesh2pcd.html">UltraMotionCapture.obj3d.mesh2pcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.mesh_crop.html">UltraMotionCapture.obj3d.mesh_crop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.np2pcd.html">UltraMotionCapture.obj3d.np2pcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.np2pvpcd.html">UltraMotionCapture.obj3d.np2pvpcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd2np.html">UltraMotionCapture.obj3d.pcd2np</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_crop.html">UltraMotionCapture.obj3d.pcd_crop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_crop_front.html">UltraMotionCapture.obj3d.pcd_crop_front</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_center.html">UltraMotionCapture.obj3d.pcd_get_center</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_max_bound.html">UltraMotionCapture.obj3d.pcd_get_max_bound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pcd_get_min_bound.html">UltraMotionCapture.obj3d.pcd_get_min_bound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pvmesh2pcd.html">UltraMotionCapture.obj3d.pvmesh2pcd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pvmesh2pcd_pro.html">UltraMotionCapture.obj3d.pvmesh2pcd_pro</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.pvmesh_fix_disconnect.html">UltraMotionCapture.obj3d.pvmesh_fix_disconnect</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.search_nearest_point.html">UltraMotionCapture.obj3d.search_nearest_point</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj3d.search_nearest_point_idx.html">UltraMotionCapture.obj3d.search_nearest_point_idx</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.html">UltraMotionCapture.obj4d</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d.html">UltraMotionCapture.obj4d.Obj4d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d_Deform.html">UltraMotionCapture.obj4d.Obj4d_Deform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.obj4d.Obj4d_Kps.html">UltraMotionCapture.obj4d.Obj4d_Kps</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.html">UltraMotionCapture.utils</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.images_to_gif.html">UltraMotionCapture.utils.images_to_gif</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.obj_pick_points.html">UltraMotionCapture.utils.obj_pick_points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_autosummary/UltraMotionCapture.utils.progress_bar.html">UltraMotionCapture.utils.progress_bar</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for UltraMotionCapture.kps</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The :mod:`UltraMotionCapture.kps` module stands for *key points*. In :mod:`UltraMotionCapture` package, key points are essential elements to facilitate the processing of 4D images.</span>

<span class="sd">There are two different perspectives to arrange key points data: *time-wise* and *point-wise*. Reflecting these two ways of arrangement:</span>

<span class="sd">- The :class:`Kps` contain all key points&#39; data at a specific moment;</span>
<span class="sd">- While the :class:`Marker` contains a specific key point&#39;s data within a time period. To aggregate all key points&#39; data, :class:`MarkerSet` is provided.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="kn">import</span> <span class="nn">UltraMotionCapture</span>
<span class="kn">import</span> <span class="nn">UltraMotionCapture.config.param</span>
<span class="kn">from</span> <span class="nn">UltraMotionCapture</span> <span class="kn">import</span> <span class="n">field</span><span class="p">,</span> <span class="n">obj3d</span><span class="p">,</span> <span class="n">utils</span>

<div class="viewcode-block" id="Kps"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps">[docs]</a><span class="k">class</span> <span class="nc">Kps</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of the key points that can be attached to a 3D object, i.e. a frame of the 4D object.</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.points</span>
<span class="sd">        :math:`N` key points in 3D space stored in a dictionary.</span>
<span class="sd">    self.scale_rate</span>
<span class="sd">        the scaling rate of the Vicon key points.</span>

<span class="sd">    Example</span>
<span class="sd">    ---</span>
<span class="sd">    After initialisation, the :class:`Kps` object is empty. Load key points from Vicon motion capture data stored in a :class:`MarkerSet` object with :meth:`load_from_markerset_frame` or :meth:`load_from_markerset_time`. ::</span>

<span class="sd">        from UltraMotionCapture import kps</span>
<span class="sd">        </span>
<span class="sd">        vicon = kps.MarkerSet()</span>
<span class="sd">        vicon.load_from_vicon(&#39;data/6kmh_softbra_8markers_1.csv&#39;)</span>
<span class="sd">        vicon.interp_field()</span>

<span class="sd">        points = kps.Kps()</span>
<span class="sd">        points.load_from_markerset_time(vicon, time = 1.01)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Kps.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="Kps.add_point"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.add_point">[docs]</a>    <span class="k">def</span> <span class="nf">add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a point to :attr:`self.points` with its name and its coordinates represented in a (3, ) :class:`numpy.array`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        name</span>
<span class="sd">            the name of the added point.</span>
<span class="sd">        point</span>
<span class="sd">            (3, ) :class:`numpy.array`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="Kps.get_points_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.get_points_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_points_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Concatenating all coordinates into a (N, 3) :class:`numpy.array` and return.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        names</span>
<span class="sd">            the names of the points to be retrieved. If doesn&#39;t input this parameter, all points will be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            coordinates stored in a (N, 3) :class:`numpy.array` in the order of the :attr:`names`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kps.diff"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.diff">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">kps1</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Kps</span><span class="p">],</span> <span class="n">kps2</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Kps</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute the difference of one key points object with another.</span>

<span class="sd">        Warning</span>
<span class="sd">        ---</span>
<span class="sd">        These two key points objects must contain the same number of points with the same names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        kps1</span>
<span class="sd">            a key points object.</span>
<span class="sd">        kps2</span>
<span class="sd">            another key points object.</span>

<span class="sd">        Returns</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`dict`</span>
<span class="sd">            A dictionary that contains the comparison result:</span>

<span class="sd">            - :code:`&#39;disp&#39;`: the displacement vectors from the predicted key points to the ground truth key points stored in a (N, 3) :class:`numpy.array`.</span>
<span class="sd">            - :code:`&#39;dist&#39;`: the distances from the first key points to the second key points stored in a (N, ) :class:`numpy.array`.</span>
<span class="sd">            - :code:`&#39;dist_mean&#39;`: the mean distances from the first key points to the second key points.</span>
<span class="sd">            - :code:`&#39;dist_std&#39;`: the standard deviation of distances.</span>
<span class="sd">            - :code:`&#39;diff_str&#39;`: a string in form of :code:`&#39;dist_mean ± dist_std (mm)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">kps1</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">points1</span> <span class="o">=</span> <span class="n">kps1</span><span class="o">.</span><span class="n">get_points_coord</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">/</span> <span class="n">kps1</span><span class="o">.</span><span class="n">scale_rate</span>
        <span class="n">points2</span> <span class="o">=</span> <span class="n">kps2</span><span class="o">.</span><span class="n">get_points_coord</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">/</span> <span class="n">kps2</span><span class="o">.</span><span class="n">scale_rate</span>

        <span class="n">disp</span> <span class="o">=</span> <span class="n">points1</span> <span class="o">-</span> <span class="n">points2</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dist_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">dist_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="n">diff_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="n">disp</span><span class="p">,</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
            <span class="s1">&#39;dist_mean&#39;</span><span class="p">:</span> <span class="n">dist_mean</span><span class="p">,</span>
            <span class="s1">&#39;dist_std&#39;</span><span class="p">:</span> <span class="n">dist_std</span><span class="p">,</span>
            <span class="s1">&#39;diff_str&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3}</span><span class="s2"> ± </span><span class="si">{:.3}</span><span class="s2"> (mm)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dist_mean</span><span class="p">,</span> <span class="n">dist_std</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">diff_dict</span></div>

<div class="viewcode-block" id="Kps.show"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Illustrate the key points object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_scene</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">camera_position</span> <span class="o">=</span> <span class="s1">&#39;xy&#39;</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Kps.add_to_scene"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Kps.html#UltraMotionCapture.kps.Kps.add_to_scene">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add the visualisation of current object to a :class:`pyvista.Plotter` scene.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        scene</span>
<span class="sd">            :class:`pyvista.Plotter` scene to add the visualisation.</span>
<span class="sd">        location</span>
<span class="sd">            the displace location represented in a (3, ) :class:`numpy.array`.</span>
<span class="sd">        radius</span>
<span class="sd">            radius of the key points</span>

<span class="sd">        **kwargs</span>
<span class="sd">            other visualisation parameters.</span>
<span class="sd">            </span>
<span class="sd">            .. seealso::</span>
<span class="sd">                `pyvista.Plotter.add_mesh &lt;https://docs.pyvista.org/api/plotting/_autosummary/pyvista.BasePlotter.add_mesh.html&gt;`_</span>
<span class="sd">                `pyvista.Plotter.add_points &lt;https://docs.pyvista.org/api/plotting/_autosummary/pyvista.BasePlotter.add_points.html&gt;`_</span>

<span class="sd">        Returns</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`pyvista.Plotter`</span>
<span class="sd">            :class:`pyvista.Plotter` scene added the visualisation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvpcd_kps</span> <span class="o">=</span> <span class="n">obj3d</span><span class="o">.</span><span class="n">np2pvpcd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_points_coord</span><span class="p">(),</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">pvpcd_kps</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Marker"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker">[docs]</a><span class="k">class</span> <span class="nc">Marker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Storing single key point&#39;s coordinates data within a time period. Usually loaded from the Vicon motion capture data. In this case, a key point is also referred as a marker.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---</span>
<span class="sd">    name</span>
<span class="sd">        the name of the marker.</span>
<span class="sd">    start_time</span>
<span class="sd">        the start time of the coordinates data.</span>
<span class="sd">    fps</span>
<span class="sd">        the number of frames per second (fps).</span>
<span class="sd">    scale_rate</span>
<span class="sd">        the scaling rate of the Vicon key points.</span>

<span class="sd">        Attention</span>
<span class="sd">        ---</span>
<span class="sd">        Noted that the original unit of Vicon raw data is millimetre (mm). The default :attr:`scale_rate` transforms it to metre (m).</span>

<span class="sd">        Warning</span>
<span class="sd">        ---</span>
<span class="sd">        This value must be the same as :class:`UltraMotionCapture.obj3d.Obj3d`&#39;s :attr:`scale_rate`.</span>

<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    cls.cab_s</span>
<span class="sd">        rotation matrix :math:`\\boldsymbol R \in \mathbb{R}^{3 \\times 3}` stored in (3, 3) :class:`numpy.array` used for converting Vicon coordinates to 3dMD coordinates.</span>
<span class="sd">    cls.cab_r</span>
<span class="sd">        scaling rate :math:`s \in \mathbb{R}` stored in a :class:`float` variable used for converting Vicon coordinates to 3dMD coordinates.</span>
<span class="sd">    cls.cab_t</span>
<span class="sd">        translation vector :math:`\\boldsymbol t \in \mathbb{R}^{3}` stored in (3, ) :class:`numpy.array` used for converting Vicon coordinates to 3dMD coordinates.</span>

<span class="sd">    self.name</span>
<span class="sd">        The name of the marker.</span>
<span class="sd">    self.start_time</span>
<span class="sd">        The start time of the coordinates data.</span>
<span class="sd">    self.fps</span>
<span class="sd">        The number of frames per second (fps).</span>
<span class="sd">    self.scale_rate</span>
<span class="sd">        the scaling rate of the Vicon key points.</span>
<span class="sd">    self.coord</span>
<span class="sd">        (3, N) :class:`numpy.array` storing the :code:`N` frames of coordinates data.</span>
<span class="sd">    self.speed</span>
<span class="sd">        (N, ) :class:`numpy.array` storing :code:`N` frames of speed data.</span>
<span class="sd">    self.accel</span>
<span class="sd">        (N, ) :class:`numpy.array` storing :code:`N` frames of acceleration data.</span>
<span class="sd">    self.frame_num</span>
<span class="sd">        The number of total frames.</span>
<span class="sd">    self.x_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`x` coordinates of all frames. Used for estimated the :math:`x` coordinate of any intermediate time between frames.</span>
<span class="sd">    self.y_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`y` coordinates of all frames. Used for estimated the :math:`y` coordinate of any intermediate time between frames.</span>
<span class="sd">    self.z_field</span>
<span class="sd">        An :class:`scipy.interpolate.interp1d` object that storing the interpolated function of the :math:`z` coordinates of all frames. Used for estimated the :math:`z` coordinate of any intermediate time between frames.</span>

<span class="sd">    Tip</span>
<span class="sd">    ---</span>
<span class="sd">    When loading Vicon motion capture data, the whole process is arranged by a :class:`MakerSet` object, which creates :class:`Marker` objects for each key point and loads data into it accordingly. Therefore, usually the end user doesn&#39;t need to touch the :class:`Marker` class.</span>

<span class="sd">    Tip</span>
<span class="sd">    ---</span>
<span class="sd">    In other parts of the package, points coordinates storing in :class:`numpy.array` are usually in the shape of (N, 3), while here we adopt (3, N), for the convenience of data interpolation :meth:`interp_field`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trans_cab</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Marker.__init__"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">scale_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_cab</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_cab_rst</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calibration parameters loaded&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">=</span> <span class="n">scale_rate</span>

        <span class="c1"># x, y, z data are stored in 3xN numpy array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># acceleration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_num</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Marker.load_cab_rst"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.load_cab_rst">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_cab_rst</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the calibration parameters from Vicon to 3dMD coordination system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mod_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">UltraMotionCapture</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">trans_cab</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Trans_Rigid</span><span class="p">(</span><span class="n">source_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="bp">cls</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mod_path</span><span class="p">,</span> <span class="s1">&#39;config/calibrate/r.npy&#39;</span><span class="p">))</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mod_path</span><span class="p">,</span> <span class="s1">&#39;config/calibrate/s.npy&#39;</span><span class="p">))</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mod_path</span><span class="p">,</span> <span class="s1">&#39;config/calibrate/t.npy&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Marker.append_data"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.append_data">[docs]</a>    <span class="k">def</span> <span class="nf">append_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">accel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">convert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append a frame of coordinates, speed, and acceleration data. after transforming to 3dMD coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        coord</span>
<span class="sd">            (3, ) :class:`numpy.array` storing the coordinates data.</span>
<span class="sd">        speed</span>
<span class="sd">            the speed storing in a :class:`float`. Default as :code:`0`.</span>
<span class="sd">        accel</span>
<span class="sd">            the acceleration storing in a :class:`float`. Default as :code:`0`.</span>
<span class="sd">        convert</span>
<span class="sd">            implement coordinates conversion or not. Default as :code:`True`. Noted that conversion include transformation from Vicon to 3dMD coordinates and the scaling effect controlled by :attr:`self.scale_rate`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># adjust array layout</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># transform to 3dMD coordinates</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">shift_points</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">speed</span>
            <span class="n">accel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="n">accel</span>

        <span class="c1"># if self.coord, self.speed, and self.accel haven&#39;t been initialised, initialise them</span>
        <span class="c1"># otherwise, append the newly arrived data to its end</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">coord</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">,</span> <span class="n">coord</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span> <span class="n">speed</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="n">accel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">accel</span><span class="p">,</span> <span class="n">accel</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Marker.fill_data"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.fill_data">[docs]</a>    <span class="k">def</span> <span class="nf">fill_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_input</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">convert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill coordinates, speed, and acceleration data of all frames after transforming to 3dMD coordinates. Noted that the first calling fills the coordinates data, the second calling fills the speed data, and the third calling fills the acceleration data, respectively.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        data_input</span>

<span class="sd">            - (3, N) :class:`numpy.array` when loading coordinates data.</span>
<span class="sd">            - Or (N, ) :class:`numpy.array` for loading speed data or acceleration data.</span>

<span class="sd">        convert</span>
<span class="sd">            implement coordinates conversion or not. Default as :code:`True`. Noted that conversion include transformation from Vicon to 3dMD coordinates and the scaling effect controlled by :attr:`self.scale_rate`.</span>

<span class="sd">        Attention</span>
<span class="sd">        ---</span>
<span class="sd">        Other than appending data frame by frame, as :meth:`append_data` does, it&#39;s more convenient to load the data at one go when data loading data from a parsed Vicon motion capture data (:meth:`MarkerSet.load_from_vicon`). This method is designed for this purpose. Usually the end user don&#39;t need to call this method manually.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
            <span class="n">data_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_cab</span><span class="o">.</span><span class="n">shift_points</span><span class="p">(</span><span class="n">data_input</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">data_input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_num</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">data_input</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accel</span> <span class="o">=</span> <span class="n">data_input</span></div>

<div class="viewcode-block" id="Marker.interp_field"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.interp_field">[docs]</a>    <span class="k">def</span> <span class="nf">interp_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolating the :math:`x, y, z` coordinates data to estimate its continues change. After that, the coordinates at the intermediate time between frames is accessible.</span>

<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        Before interpolation, the coordinates data, i.e. :attr:`self.coord`, must be properly loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coordinates information not found&quot;</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="n">frame_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">frame_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;slinear&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Marker.get_frame_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.get_frame_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_frame_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to frame id.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to get coordinates data.</span>
<span class="sd">        </span>
<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[0-2 as x-z][frame_id]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[:,</span> <span class="n">frame_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="Marker.get_time_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.get_time_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to time stamp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        time</span>
<span class="sd">            time stamp to get coordinates data.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[0-2 as x-z][time]`</span>
<span class="sd">        </span>
<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        The interpolation must be properly done before accessing coordinates data according to time stamp, which means the :meth:`interp_field` must be called first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coordinates field need to be interped first&quot;</span><span class="p">)</span>
            
            <span class="k">return</span>

        <span class="n">frame_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span>
        <span class="n">coord_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">y_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">z_field</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">coord_interp</span></div>

<div class="viewcode-block" id="Marker.diff"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.diff">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">marker1</span><span class="p">:</span> <span class="n">Marker</span><span class="p">,</span> <span class="n">marker2</span><span class="p">:</span> <span class="n">Marker</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute the difference of one marker object with another.</span>

<span class="sd">        Warning</span>
<span class="sd">        ---</span>
<span class="sd">        For a frame from the first marker, its difference with the second marker is computed referencing with the corresponding time slice of the second marker. Therefore, the second marker must contain the time period of the first object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        marker1</span>
<span class="sd">            a marker object.</span>
<span class="sd">        marker2</span>
<span class="sd">            another marker object.</span>

<span class="sd">        Returns</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`dict`</span>
<span class="sd">            A dictionary that contains the comparison result:</span>

<span class="sd">            - :code:`&#39;disp&#39;`: the displacement vectors from the predicted key points to the ground truth key points stored in a (N, 3) :class:`numpy.array`.</span>
<span class="sd">            - :code:`&#39;dist&#39;`: the distances from the first marker to the second marker stored in a (N, ) :class:`numpy.array`.</span>
<span class="sd">            - :code:`&#39;dist_mean&#39;`: the mean distances from the first marker to the second marker.</span>
<span class="sd">            - :code:`&#39;dist_std&#39;`: the standard deviation of distances.</span>
<span class="sd">            - :code:`&#39;diff_str&#39;`: a string in form of :code:`&#39;dist_mean ± dist_std (mm)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">marker1</span><span class="o">.</span><span class="n">frame_num</span><span class="p">):</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">marker1</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">frame</span> <span class="o">/</span> <span class="n">marker1</span><span class="o">.</span><span class="n">fps</span>
            <span class="n">coord1</span> <span class="o">=</span> <span class="n">marker1</span><span class="o">.</span><span class="n">get_frame_coord</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">/</span> <span class="n">marker1</span><span class="o">.</span><span class="n">scale_rate</span>
            <span class="n">coord2</span> <span class="o">=</span> <span class="n">marker2</span><span class="o">.</span><span class="n">get_time_coord</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">/</span> <span class="n">marker2</span><span class="o">.</span><span class="n">scale_rate</span>
            <span class="n">disp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord1</span> <span class="o">-</span> <span class="n">coord2</span><span class="p">)</span>
            
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dist_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">dist_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="n">diff_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="n">disp</span><span class="p">,</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
            <span class="s1">&#39;dist_mean&#39;</span><span class="p">:</span> <span class="n">dist_mean</span><span class="p">,</span>
            <span class="s1">&#39;dist_std&#39;</span><span class="p">:</span> <span class="n">dist_std</span><span class="p">,</span>
            <span class="s1">&#39;diff_str&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3}</span><span class="s2"> ± </span><span class="si">{:.3}</span><span class="s2"> (mm)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dist_mean</span><span class="p">,</span> <span class="n">dist_std</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">diff_dict</span></div>

<div class="viewcode-block" id="Marker.plot_track"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_track">[docs]</a>    <span class="k">def</span> <span class="nf">plot_track</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">line_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">line_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dot_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dot_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">line_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">dot_s</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">dot_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
        <span class="n">is_show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">is_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plotting the marker motion track.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        line_start_frame</span>
<span class="sd">            start frame of line plotting.</span>
<span class="sd">        line_end_frame</span>
<span class="sd">            end frame of line plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        dot_start_frame</span>
<span class="sd">            start frame of dot plotting.</span>
<span class="sd">        dot_end_frame</span>
<span class="sd">            end frame of dot plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        is_show</span>
<span class="sd">            weather show the generated graph or not.</span>
<span class="sd">        is_save</span>
<span class="sd">            weather save the generated graph or not.</span>
<span class="sd">        Others</span>
<span class="sd">            parameters passed to :meth:`plot_add_line` and :meth:`plot_add_dot` to controlling the appearance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_add_line</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">line_start_frame</span><span class="p">,</span>
            <span class="n">line_end_frame</span><span class="p">,</span>
            <span class="n">line_alpha</span><span class="p">,</span>
            <span class="n">line_width</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_add_dot</span><span class="p">(</span>
            <span class="n">ax</span><span class="p">,</span>
            <span class="n">dot_start_frame</span><span class="p">,</span>
            <span class="n">dot_end_frame</span><span class="p">,</span>
            <span class="n">dot_s</span><span class="p">,</span>
            <span class="n">dot_alpha</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marker Point Trajectory</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;output/save-line&#39;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_start_frame</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_end_frame</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;-dot&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dot_start_frame</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dot_end_frame</span><span class="p">))</span></div>

<div class="viewcode-block" id="Marker.plot_add_line"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_add_line">[docs]</a>    <span class="k">def</span> <span class="nf">plot_add_line</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">,</span>
            <span class="n">line_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">line_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">line_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">line_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adding motion track lines to the :class:`matplotlib.pyplot.subplot` object created in :meth:`plot_track`.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        About the appearance controlling parameters, please refer to `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_.</span>

<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_start_frame</span><span class="p">:</span><span class="n">line_end_frame</span><span class="p">],</span>
            <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">line_alpha</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Marker.plot_add_dot"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.Marker.html#UltraMotionCapture.kps.Marker.plot_add_dot">[docs]</a>    <span class="k">def</span> <span class="nf">plot_add_dot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">,</span>
            <span class="n">dot_start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">dot_end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">dot_s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">dot_alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adding motion dots in different frames to the :class:`matplotlib.pyplot.subplot` object created in :meth:`plot_track`.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        About the appearance controlling parameters, please refer to `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_.</span>

<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter3D</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">dot_start_frame</span><span class="p">:</span><span class="n">dot_end_frame</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">dot_s</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">dot_alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="MarkerSet"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet">[docs]</a><span class="k">class</span> <span class="nc">MarkerSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of :class:`Marker` s. At current stage, it&#39;s usually loaded from the Vicon motion capture data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---</span>
<span class="sd">    filedir</span>
<span class="sd">        directory of the :code:`.csv` key points coordinates data exported from the motion capture Vicon system.</span>
<span class="sd">    scale_rate</span>
<span class="sd">        the scaling rate of the Vicon key points.</span>

<span class="sd">        Attention</span>
<span class="sd">        ---</span>
<span class="sd">        Noted that the original unit of Vicon raw data is millimetre (mm). The default :attr:`scale_rate` transforms it to metre (m).</span>

<span class="sd">        Warning</span>
<span class="sd">        ---</span>
<span class="sd">        This value must be the same as :class:`UltraMotionCapture.obj3d.Obj3d`&#39;s :attr:`scale_rate`.</span>


<span class="sd">    Note</span>
<span class="sd">    ---</span>
<span class="sd">    `Class Attributes`</span>

<span class="sd">    self.fps</span>
<span class="sd">        the number of frames per second (fps).</span>
<span class="sd">    self.scale_rate</span>
<span class="sd">        the scaling rate of the Vicon key points.</span>
<span class="sd">    self.markers</span>
<span class="sd">        a :class:`Dictonary` of :class:`Marker` s, with the corresponding marker names as their keywords.</span>

<span class="sd">    Example</span>
<span class="sd">    ---</span>
<span class="sd">    The Vicon motion capture data shall be exported as a :code:`.csv` file. After initialising the :class:`MarkerSet` data, we can load it providing the :code:`.csv` file&#39;s directory: ::</span>

<span class="sd">        from UltraMotionCapture import kps</span>

<span class="sd">        vicon = kps.MarkerSet()</span>
<span class="sd">        vicon.load_from_vicon(&#39;data/6kmh_softbra_8markers_1.csv&#39;)</span>
<span class="sd">        vicon.interp_field()</span>

<span class="sd">    Usually we implement the interpolation after loading the data, as shown in the last line of code. Then we can access the coordinates, speed, and acceleration data of any marker at any specific time: ::</span>

<span class="sd">        print(vicon.get_frame_coord(10))</span>
<span class="sd">        print(vicon.get_time_coord(1.0012)</span>

<span class="sd">    We can also access the specific marker with the marker name: ::</span>

<span class="sd">        print(vicon.points.keys())</span>
<span class="sd">        print(vicon.points[&#39;Bra_Miss Sun:CLAV&#39;].get_frame_coord(10))</span>
<span class="sd">        print(vicon.points[&#39;Bra_Miss Sun:CLAV&#39;].get_time_coord(1.0012))</span>

<span class="sd">    We can also plot and save the motion track as a :code:`.gif` file for illustration: ::</span>

<span class="sd">        vicon.plot_track(step=3, end_frame=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MarkerSet.load_from_vicon"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.load_from_vicon">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_vicon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filedir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scale_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load and parse data from :code:`.csv` file exported from the Vicon motion capture system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        filedir</span>
<span class="sd">            the directory of the :code:`.csv` file.</span>
<span class="sd">        scale_rate</span>
<span class="sd">            the scaling rate of the 3D object.</span>

<span class="sd">            .. attention::</span>
<span class="sd">                Noted that the original unit of 3dMD raw data is millimetre (mm). The default :attr:`scale_rate` transforms it to metre (m).</span>

<span class="sd">            .. seealso::</span>
<span class="sd">                Reason for providing :code:`scale_rate` parameter is explained in :class:`Obj3d_Deform`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">=</span> <span class="n">scale_rate</span>

        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_head</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">df_head</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># parse the fps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">col_names</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">col_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)):</span>
                <span class="n">col_name</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">[</span><span class="n">col_id</span><span class="p">]</span>
                <span class="n">point_name</span> <span class="o">=</span> <span class="n">col_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># skip columns that contain NaN</span>
                <span class="c1"># (checking start from row 4, because for speed and acceleration the first few rows are empty)</span>
                <span class="c1"># or that follows the &#39;X&#39; columns</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span> <span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="s1">&#39;Unnamed&#39;</span> <span class="ow">in</span> <span class="n">col_name</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># the first occurrence of a point</span>
                <span class="k">if</span> <span class="n">point_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="n">point_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Marker</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">point_name</span><span class="p">,</span> 
                        <span class="n">fps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span> 
                        <span class="n">scale_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span><span class="p">)</span>

                <span class="c1"># fill the following 3 columns&#39; X, Y, Z values into the point&#39;s object</span>
                <span class="n">data_input</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="n">col_name</span><span class="p">:</span><span class="n">col_names</span><span class="p">[</span><span class="n">col_id</span><span class="o">+</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="n">point_name</span><span class="p">]</span><span class="o">.</span><span class="n">fill_data</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># skip the first two rows</span>
        <span class="n">df_head</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># only read the first two rows</span>
        <span class="n">parse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df_head</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loaded 1 vicon file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filedir</span><span class="p">))</span></div>

<div class="viewcode-block" id="MarkerSet.interp_field"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.interp_field">[docs]</a>    <span class="k">def</span> <span class="nf">interp_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After loading Vicon motion capture data, the :class:`MarkerSet` object only carries the key points&#39; coordinates in discrete frames. To access the coordinates at any specific time, it&#39;s necessary to call :meth:`interp_field`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">point</span><span class="o">.</span><span class="n">interp_field</span><span class="p">()</span></div>

<div class="viewcode-block" id="MarkerSet.get_frame_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.get_frame_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_frame_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">kps_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Kps</span><span class="p">]</span> <span class="o">=</span> <span class="n">Kps</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">Kps</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to frame id and packed as a :class:`Kps` object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to get coordinates data.</span>
<span class="sd">        kps_class</span>
<span class="sd">            the class of key points object to be initialised and returned.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`Kps` or its derived class</span>
<span class="sd">            The extracted coordinates data packed as a :class:`Kps` (or its derived class) object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kps</span> <span class="o">=</span> <span class="n">kps_class</span><span class="p">()</span>
        <span class="n">kps</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">get_frame_coord</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
            <span class="n">kps</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kps</span></div>

<div class="viewcode-block" id="MarkerSet.diff"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.diff">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">markerset1</span><span class="p">:</span> <span class="n">MarkerSet</span><span class="p">,</span> <span class="n">markerset2</span><span class="p">:</span> <span class="n">MarkerSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute the difference of one marker set object with another.</span>

<span class="sd">        Warning</span>
<span class="sd">        ---</span>
<span class="sd">        The same as :meth:`Marker.diff`, the second marker set must contain the time period of the first marker set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        marker1</span>
<span class="sd">            a marker set object.</span>
<span class="sd">        marker2</span>
<span class="sd">            another marker set object.</span>

<span class="sd">        Returns</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`dict`</span>
<span class="sd">            A dictionary that contains the comparison result:</span>

<span class="sd">            - :code:`diff_dict`: a dictionary that stores the original comparison results between each pair of key points.</span>
<span class="sd">            - :code:`&#39;dist_mean&#39;`: the mean distances from the first marker set to the second marker set.</span>
<span class="sd">            - :code:`&#39;dist_std&#39;`: the standard deviation of distances.</span>
<span class="sd">            - :code:`&#39;diff_str&#39;`: a string in form of :code:`&#39;dist_mean ± dist_std (mm)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># estimate the difference of each key point</span>
        <span class="n">diff_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dist_ls</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">markerset1</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">Marker</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">markerset1</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">markerset2</span><span class="o">.</span><span class="n">markers</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">diff_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff</span>
            <span class="n">dist_ls</span> <span class="o">=</span> <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;estimated error of frame </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;diff_str&#39;</span><span class="p">]))</span>

        <span class="c1"># estimate the overall difference</span>
        <span class="n">dist_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dist_ls</span><span class="p">)</span>
        <span class="n">dist_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dist_array</span><span class="p">)</span>
        <span class="n">dist_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dist_array</span><span class="p">)</span>

        <span class="c1"># combine the estimation result and print the overall difference</span>
        <span class="n">overall_diff_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;diff_dict&#39;</span><span class="p">:</span> <span class="n">diff_dict</span><span class="p">,</span>
            <span class="s1">&#39;dist_mean&#39;</span><span class="p">:</span> <span class="n">dist_mean</span><span class="p">,</span>
            <span class="s1">&#39;dist_std&#39;</span><span class="p">:</span> <span class="n">dist_std</span><span class="p">,</span>
            <span class="s1">&#39;diff_str&#39;</span><span class="p">:</span> <span class="s2">&quot;diff = </span><span class="si">{:.3}</span><span class="s2"> ± </span><span class="si">{:.3}</span><span class="s2"> (mm)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dist_mean</span><span class="p">,</span> <span class="n">dist_std</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;whole duration error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overall_diff_dict</span><span class="p">[</span><span class="s1">&#39;diff_str&#39;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">overall_diff_dict</span></div>

<div class="viewcode-block" id="MarkerSet.get_time_coord"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.get_time_coord">[docs]</a>    <span class="k">def</span> <span class="nf">get_time_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates data according to time stamp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        time</span>
<span class="sd">            time stamp to get coordinates data.</span>

<span class="sd">        Return</span>
<span class="sd">        ---</span>
<span class="sd">        :class:`numpy.array`</span>
<span class="sd">            The structure of the returned array is :code:`array[marker_id][0-2 as x-z][time]`</span>
<span class="sd">        </span>
<span class="sd">        Warnings</span>
<span class="sd">        ---</span>
<span class="sd">        The interpolation must be properly done before accessing coordinates data according to time stamp, which means the :meth:`interp_field` must be called first.</span>

<span class="sd">        WARNING</span>
<span class="sd">        ---</span>
<span class="sd">        The returned value will be transferred to :class:`Kps` in future development.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kps</span> <span class="o">=</span> <span class="n">Kps</span><span class="p">()</span>
        <span class="n">kps</span><span class="o">.</span><span class="n">scale_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rate</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">get_time_coord</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="n">kps</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kps</span></div>

<div class="viewcode-block" id="MarkerSet.plot_track"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.plot_track">[docs]</a>    <span class="k">def</span> <span class="nf">plot_track</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">end_frame</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">remove</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plotting the marker motion track.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        start_frame</span>
<span class="sd">            start frame of plotting.</span>
<span class="sd">        end_frame</span>
<span class="sd">            end frame of plotting, default as :code:`None`, which means plot till the end.</span>
<span class="sd">        step</span>
<span class="sd">            Plot 1 frame for every :code:`step` frame. The purpose is reducing graph generating time.</span>
<span class="sd">        remove</span>
<span class="sd">            after generating the :code:`.gif` file, remove the frames&#39; images or not.</span>

<span class="sd">        Tip</span>
<span class="sd">        ---</span>
<span class="sd">        Additional appearance controlling parameters can be passed into :code:`**kwargs`, please refer to `*args and **kwargs - Python Tips &lt;https://book.pythontips.com/en/latest/args_and_kwargs.html&gt;`_ and `Pyplot tutorial - matplotlib &lt;https://matplotlib.org/stable/tutorials/introductory/pyplot.html#pyplot-tutorial&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">end_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">first_point</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">end_frame</span> <span class="o">=</span> <span class="n">first_point</span><span class="o">.</span><span class="n">frame_num</span>

        <span class="k">for</span> <span class="n">frame_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_frame</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_frame</span><span class="p">(</span><span class="n">frame_id</span><span class="p">,</span> <span class="n">is_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">images_to_gif</span><span class="p">(</span><span class="s1">&#39;output/&#39;</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="n">remove</span><span class="p">)</span></div>

<div class="viewcode-block" id="MarkerSet.plot_frame"><a class="viewcode-back" href="../../_autosummary/UltraMotionCapture.kps.MarkerSet.html#UltraMotionCapture.kps.MarkerSet.plot_frame">[docs]</a>    <span class="k">def</span> <span class="nf">plot_frame</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
            <span class="n">is_add_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">is_save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a specific frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---</span>
<span class="sd">        frame_id</span>
<span class="sd">            index of the frame to be plotted.</span>
<span class="sd">        dpi</span>
<span class="sd">            the dots per inch (dpi) of the generated graph, controlling the graph quality.</span>
<span class="sd">        is_add_line</span>
<span class="sd">            weather add track links or not</span>
<span class="sd">        is_show</span>
<span class="sd">            weather show the generated graph or not.</span>
<span class="sd">        is_save</span>
<span class="sd">            weather save the generated graph or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">point</span><span class="o">.</span><span class="n">plot_add_dot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">frame_id</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_add_line</span><span class="p">:</span>
                <span class="n">point</span><span class="o">.</span><span class="n">plot_add_line</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marker Point Trajectory&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z-axis&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;output/gif-</span><span class="si">{:0&gt;4d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame_id</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">is_show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
            <span class="n">filedir</span> <span class="o">=</span> <span class="s1">&#39;output/gif-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">frame_id</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filedir</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">UltraMotionCapture</span><span class="o">.</span><span class="n">output_msg</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved &#39;</span> <span class="o">+</span> <span class="n">filedir</span><span class="p">)</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Dr. Kit-lun Yick&#39;s Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    </body>
</html>